!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SimpleZoom=e():t.SimpleZoom=e()}(this,(function(){return function(t){var e={};function o(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(s,i,function(e){return t[e]}.bind(null,i));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="./",o(o.s=1)}([function(t,e){},function(t,e,o){"use strict";function s(t){(t=t||window.event).preventDefault?t.preventDefault():t.returnValue=!1}function i(t,e){if(typeof t!=typeof e)throw new Error("compare failed, not the same type");if("object"!=typeof t)return t===e;for(let o in t)if("object"!=typeof t[o]){if(t[o]!==e[o])return!1}else i(t[o],e[o]);return!0}function n(t,e){let{clientTop:o,clientLeft:s}=t;return Array.from(e).map(t=>({clientX:t.clientX,clientY:t.clientY,force:t.force,identifier:t.identifier,pageX:t.pageX,pageY:t.pageY,radiusX:t.radiusX,radiusY:t.radiusY,rotationAngle:t.rotationAngle,screenX:t.screenX,screenY:t.screenY,offsetX:t.clientX-o,offsetY:t.clientY-s}))}function r(t,e,o,s){let{clientWidth:i,clientHeight:n}=t;return{top:o.y-s.y*(e-1),right:(i-s.x)*(1-e)-o.x,bottom:(n-s.y)*(1-e)-o.y,left:o.x-s.x*(e-1)}}o.r(e),o(0);const a=Object.assign;function h(t){let{minZoom:e,maxZoom:o,zoomSpeed:i}=this.options,{zoomable:n,dragable:h,zoom:l,translate:c,transformOrigin:m}=this.state;if(!n)return;s(t),function(t){(t=t||window.event).stopPropagation?t.stopPropagation():t.cancelBubble=!0}(t);let{offsetX:u,offsetY:f}=function(t,e){let{target:o,offsetX:s,offsetY:i}=t;if(o instanceof SVGElement||e instanceof SVGElement)return{offsetX:s,offsetY:i};for(;o!==e;)s+=o.offsetLeft,i+=o.offsetTop,o=o.offsetParent;return{offsetX:s,offsetY:i}}(t,this.el),d=l+Math.max(-1,Math.min(1,t.wheelDelta||-t.detail))*i;if(d<e?d=e:d>o?d=o:Math.abs(d-1)<i/2&&(d=1),d<=1)h=!1,c={x:0,y:0},m={x:this.el.clientWidth/2,y:this.el.clientHeight/2};else{h=!0,c={x:c.x,y:c.y},m={x:u,y:f};let t=r(this.el,d,c,m);for(let e in t)if(t[e]>0)switch(e){case"top":c.y-=t.top;break;case"right":c.x+=t.right;break;case"bottom":c.y+=t.bottom;break;case"left":c.x-=t.left}}this.setState(a({},this.state,{dragable:h,zoom:d,translate:c,transformOrigin:m}))}function l(){let{movingTranslate:t}=this.state;this.setState(a({},this.state,{translate:a({},t),isMouseMoving:!1})),this.el.classList.remove("move"),this.el.removeEventListener("mousemove",this._on.mousemove),this.el.removeEventListener("mouseup",this._on.mouseup),this.el.removeEventListener("mouseout",this._on.mouseout)}o.d(e,"default",(function(){return u}));const c=Object.assign,m={zoomable:!0,dragable:!0,initZoom:1,minZoom:1,maxZoom:5,zoomSpeed:.1,padding:0};class u{constructor(t,e={}){if(!t)throw new Error("please provide a target element!");if("string"==typeof t){if(this.el=document.querySelector(t),!this.el)throw new Error("target is not found!")}else if("object"==typeof t){if(o=t,!("object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&1===o.nodeType&&"string"==typeof o.nodeName))throw new Error("target is not HTMLElement!");this.el=t}var o;if(!this.el.parentNode||!this.el.parentNode.tagName)throw new Error("target can not be root-element!");if(this.parentNode=this.el.parentNode,this.parentNode.classList.add("simple-zoom-container"),"object"!=typeof e)throw new Error("options is supposed to be an object!");this.options=c({},m,e),this.options.padding=Math.min(this.el.clientWidth/2,this.el.clientHeight/2,this.options.padding),this.options.initZoom=Math.max(Math.max(this.options.minZoom,this.options.initZoom),Math.min(this.options.maxZoom,this.options.initZoom));let i=this.el.classList;i.add("simple-zoom-el"),this.options.zoomable||i.add("zoom-locked"),this.options.dragable||i.add("drag-locked"),this._on={mousewheel:h.bind(this),DOMMouseScroll:h.bind(this),mousedown:function(t){let{dragable:e,translate:o}=this.state;if(!e)return;s(t);let{clientX:i,clientY:n}=t;this.setState(a({},this.state,{isMouseMoving:!0,moveStart:{x:i,y:n},movingTranslate:a({},o)})),this.el.classList.add("move"),this.el.addEventListener("mousemove",this._on.mousemove),this.el.addEventListener("mouseup",this._on.mouseup),this.el.addEventListener("mouseout",this._on.mouseout)}.bind(this),mousemove:function(t){let{padding:e}=this.options,{zoom:o,translate:i,transformOrigin:n,moveStart:h}=this.state;s(t);let{clientX:l,clientY:c}=t,m={x:i.x+(l-h.x),y:i.y+(c-h.y)},u=r(this.el,o,m,n);for(let t in u)if(u[t]>e)switch(t){case"top":m.y=n.y*(o-1)+e;break;case"right":m.x=(this.el.clientWidth-n.x)*(1-o)-e;break;case"bottom":m.y=(this.el.clientHeight-n.y)*(1-o)-e;break;case"left":m.x=n.x*(o-1)+e}this.setState(a({},this.state,{movingTranslate:m}))}.bind(this),mouseup:l.bind(this),mouseout:l.bind(this),touchmovestart:function(t){let{dragable:e,isTouchZoom:o,translate:i}=this.state;e&&!o&&(s(t),2!==n(this.parentNode,t.touches).length&&(this.state.touchTimer=setTimeout(()=>{let e=t.touches[0],{clientX:o,clientY:s}=e;this.setState(a({},this.state,{touchTimer:null,isTouchMoving:!0,touchStart:{x:o,y:s},movingTranslate:a({},i)})),this.parentNode.addEventListener("touchmove",this._on.touchmove),this.parentNode.addEventListener("touchend",this._on.touchmoveend)},100)))}.bind(this),touchmove:function(t){let{padding:e}=this.options,{zoom:o,translate:i,touchStart:h,movingTranslate:l,transformOrigin:c}=this.state;s(t);let m=n(this.parentNode,t.touches),{clientX:u,clientY:f}=m[0],d={x:i.x+(u-h.x),y:i.y+(f-h.y)},p=r(this.el,o,d,c);for(let t in p)if(p[t]>e)switch(t){case"top":d.y=c.y*(o-1)+e;break;case"right":d.x=(this.el.clientWidth-c.x)*(1-o)-e;break;case"bottom":d.y=(this.el.clientHeight-c.y)*(1-o)-e;break;case"left":d.x=c.x*(o-1)+e}this.setState(a({},this.state,{movingTranslate:d}))}.bind(this),touchmoveend:function(){let{movingTranslate:t}=this.state;this.setState(a({},this.state,{translate:a({},t),isTouchMoving:!1})),this.parentNode.removeEventListener("touchmove",this._on.touchmove),this.parentNode.removeEventListener("touchend",this._on.touchmoveend)}.bind(this),touchzoomstart:function(t){let{zoomable:e,touchTimer:o,isTouchMoving:i}=this.state;if(!e||i)return;s(t);let r=n(this.parentNode,t.touches);if(2===r.length){o&&window.clearTimeout(o);let[t,e]=r;this.setState(a({},this.state,{touchTimer:null,isTouchZoom:!0,touchDistance:Math.sqrt(Math.pow(t.offsetX-e.offsetX,2)+Math.pow(t.offsetY-e.offsetY,2))})),this.parentNode.addEventListener("touchmove",this._on.touchzoom),this.parentNode.addEventListener("touchend",this._on.touchzoomend)}}.bind(this),touchzoom:function(t){s(t);let{minZoom:e,maxZoom:o,zoomSpeed:i}=this.options,{dragable:h,zoom:l,translate:c,transformOrigin:m,touchZoomTimer:u,touchDistance:f}=this.state,d=n(this.parentNode,t.touches),p=d.length,[v,g]=d;if(1===p)return void this._on.onTouchZoomEnd();if(u)return;this.state.touchZoomTimer=setTimeout(()=>{this.state.touchZoomTimer=null},100);let b=Math.sqrt(Math.pow(v.offsetX-g.offsetX,2)+Math.pow(v.offsetY-g.offsetY,2)),y=l*(b/f);if(y<e?y=e:y>o?y=o:Math.abs(y-1)<i/2&&(y=1),y<=1)h=!1,c={x:0,y:0},m={x:this.el.clientWidth/2,y:this.el.clientHeight/2};else{h=!0,c={x:c.x,y:c.y},m={x:(v.offsetX+g.offsetX)/2,y:(v.offsetY+g.offsetY)/2};let t=r(this.el,y,c,m);for(let e in t)if(t[e]>0)switch(e){case"top":c.y-=t.top;break;case"right":c.x+=t.right;break;case"bottom":c.y+=t.bottom;break;case"left":c.x-=t.left}}this.setState(a({},this.state,{dragable:h,zoom:y,translate:c,transformOrigin:m,touchDistance:b}))}.bind(this),touchzoomend:function(){this.setState(a({},this.state,{isTouchZoom:!1})),this.parentNode.removeEventListener("touchmove",this._on.touchzoom),this.parentNode.removeEventListener("touchmoveend",this._on.touchzoomend)}.bind(this)},this._onListeners=Object.create(null),this._eventListeners=Object.create(null),this._init()}_init(){this.reset(),this.update();let{zoomable:t,dragable:e}=this.options;t&&(this.el.addEventListener("mousewheel",this._on.mousewheel),this.el.addEventListener("DOMMouseScroll",this._on.DOMMouseScroll),this.parentNode.addEventListener("touchstart",this._on.touchzoomstart)),e&&(this.el.addEventListener("mousedown",this._on.mousedown),this.parentNode.addEventListener("touchstart",this._on.touchmovestart))}_setTransform(t,e){let{x:o,y:s}=e;this.el.style.transform=`scale(${t}) translate(${o/t}px,${s/t}px)`}_setTransformOrigin(t){let{x:e,y:o}=t;this.el.style.transformOrigin=`${e}px ${o}px`}_dispatchEvent(t,e){let o={type:t,data:e,timestamp:Date.now()};if(this._onListeners[t])try{this._onListeners[t](o)}catch(t){console.warn(t)}this._eventListeners[t]&&this._eventListeners[t].length&&this._eventListeners[t].forEach(t=>{try{t(o)}catch(t){console.warn(t)}})}reset(){let{zoomable:t,dragable:e,initZoom:o}=this.options,s={zoomable:t,dragable:e,zoom:o,translate:{x:0,y:0},movingTranslate:{x:0,y:0},transformOrigin:{x:this.el.clientWidth/2,y:this.el.clientHeight/2},isMouseMoving:!1,moveStart:{x:0,y:0},touchTimer:null,isTouchMoving:!1,isTouchZoom:!1,touchStart:{x:0,y:0},touchZoomTimer:null,touchDistance:0};o<=1&&(s.dragable=!1),this.setState(s)}update(){let{zoom:t,translate:e,transformOrigin:o}=this.state;this._setTransform(t,e),this._setTransformOrigin(o)}destroy(){let{zoomable:t,dragable:e}=this.options;t&&(this.el.removeEventListener("mousewheel",this._on.mousewheel),this.el.removeEventListener("DOMMouseScroll",this._on.DOMMouseScroll),this.parentNode.removeEventListener("touchstart",this._on.touchzoomstart)),e&&(this.el.removeEventListener("mousedown",this._on.mousedown),this.parentNode.removeEventListener("touchstart",this._on.touchmovestart))}setState(t){this.state=this.state||t;let e=t.isMouseMoving||t.isTouchMoving,o=!i(this.state.zoom,t.zoom),s=!i(this.state.translate,t.translate),n=!i(this.state.transformOrigin,t.transformOrigin);this.state=c({},this.state,t),e?this._setTransform(t.zoom,t.movingTranslate):(o||s)&&this._setTransform(t.zoom,t.translate),n&&this._setTransformOrigin(t.transformOrigin),(e||s)&&this._dispatchEvent("move",t),(o||n)&&this._dispatchEvent("zoom",t),this._dispatchEvent("updated",t)}on(t,e){if("string"!=typeof t)throw new Error("event type must be a string");if("function"!=typeof e)throw new Error("event callback type must be a string");this._onListeners[t]=e}off(t){this._onListeners[t]=()=>{}}addEventListener(t,e){if("string"!=typeof t)throw new Error("event type must be a string");if("function"!=typeof e)throw new Error("event callback type must be a string");this._eventListeners[t]?this._eventListeners[t].push(e):this._eventListeners[t]=[e]}removeEventListener(t,e){this._eventListeners[t]&&this._eventListeners[t].length&&(this._eventListeners[t]=this._eventListeners[t].filter(t=>t!==e))}subscribe(t){t&&t instanceof u&&t.addEventListener("updated",t=>{this.setState(t.data)})}}}]).default}));
//# sourceMappingURL=simple-zoom.js.map